<?php
session_start();
if (!$_SESSION['admin']) { Header("Location: index.php"); exit; }
?>
<?php
//проверяем загрузку файла на наличие ошибок
if($_FILES['uploadfile']['error'] > 0)
{
 //в зависимости от номера ошибки выводим соответствующее сообщение
 //UPLOAD_MAX_FILE_SIZE - значение установленное в php.ini
 //MAX_FILE_SIZE значение указанное в html-форме загрузки файла
 switch ($_FILES['uploadfile']['error'])
 {
 case 1: echo 'Размер файла превышает допустимое значение UPLOAD_MAX_FILE_SIZE'; break;
 case 2: echo 'Размер файла превышает допустимое значение MAX_FILE_SIZE'; break;
 case 3: echo 'Не удалось загрузить часть файла'; break;
 case 4: echo 'Файл не был загружен'; break;
 case 6: echo 'Отсутствует временная папка.'; break;
 case 7: echo 'Не удалось записать файл на диск.'; break;
 case 8: echo 'PHP-расширение остановило загрузку файла.'; break;
 }
 exit;
} 
 
//проверяем не является ли загружаемый файл php скриптом,
//при необходимости можете дописать нужные типы файлов
$blacklist = array(".php", ".phtml", ".php3", ".php4", ".html");
foreach ($blacklist as $item)
{
 if(preg_match("/$item\$/i", $_FILES['uploadfile']['name']))
 {
 echo "Нельзя загружать скрипты.";
 exit;
 }
}
 
//проверяем MIME-тип файла
if($_FILES['uploadfile']['type'] != 'application/zip')
{
 echo 'Вы пытаетесь загрузить не zip файл.';
 exit;
}

//папка для загрузки
$uploaddir = '../nightly/';
//новое сгенерированное имя файла
$newFileName=date('F j, Y, H:i:s').rand(10,100).'.zip';
//путь к файлу (папка.файл)
$uploadfile = $uploaddir.$newFileName;

//загружаем файл move_uploaded_file
if (move_uploaded_file($_FILES['uploadfile']['tmp_name'], $uploadfile))
echo "Выбранный файл загружен.\n";
else
echo "Ошибка загрузки файла.\n";
?>